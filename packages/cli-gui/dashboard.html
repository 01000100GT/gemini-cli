<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gemini Desktop Dashboard</title>
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/dashboard.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div id="logo-container"></div>
            <button id="new-task-button" class="new-task-button">+ New Task</button>
        </div>

        <div class="content-area">
            <div class="task-section">
                <h2>Running</h2>
                <div id="running-tasks" class="task-list"></div>
            </div>

            <div class="task-section">
                <div class="task-section-header">
                    <h2>History</h2>
                    <button id="clear-history-button" class="clear-history-button">Clear History</button>
                </div>
                <div id="history-tasks" class="task-list"></div>
            </div>
        </div>
    </div>
    <script>
        const runningTasks = document.getElementById('running-tasks');
        const historyTasks = document.getElementById('history-tasks');
        const newTaskButton = document.getElementById('new-task-button');
        const clearHistoryButton = document.getElementById('clear-history-button');

        function formatTimeAgo(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const seconds = Math.round((now - date) / 1000);
            const minutes = Math.round(seconds / 60);
            const hours = Math.round(minutes / 60);
            const days = Math.round(hours / 24);

            if (seconds < 60) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        function createTaskElement(task) {
            const element = document.createElement('div');
            element.className = 'task-card';
            element.innerHTML = `
                <div class="task-card-content">
                    <div class="task-card-title">${task.title}</div>
                    <div class="task-card-description">${task.description}</div>
                    <div class="task-card-timestamp">${formatTimeAgo(task.timestamp)}</div>
                </div>
                <div class="task-card-actions">
                    <div class="task-menu">
                        <button class="task-menu-button">...</button>
                        <div class="task-menu-content">
                            <a href="#" class="delete-task">Delete</a>
                        </div>
                    </div>
                </div>
            `;

            element.querySelector('.task-card-content').addEventListener('click', () => {
                window.electron.send('navigate-to-chat', task.id);
            });

            const menuButton = element.querySelector('.task-menu-button');
            const menuContent = element.querySelector('.task-menu-content');
            const deleteButton = element.querySelector('.delete-task');

            menuButton.addEventListener('click', (event) => {
                event.stopPropagation();
                menuContent.classList.toggle('show');
            });

            deleteButton.addEventListener('click', (event) => {
                event.stopPropagation();
                window.electron.send('delete-task', task.id);
                menuContent.classList.remove('show');
            });

            return element;
        }

        window.electron.on('update-tasks', (tasks) => {
            runningTasks.innerHTML = '';
            historyTasks.innerHTML = '';

            tasks.running.forEach(task => runningTasks.appendChild(createTaskElement(task)));
            tasks.history.forEach(task => historyTasks.appendChild(createTaskElement(task)));
        });

        newTaskButton.addEventListener('click', () => {
            window.electron.send('create-new-task');
        });

        clearHistoryButton.addEventListener('click', () => {
            window.electron.send('clear-history');
        });

        window.electron.send('get-tasks');
    </script>
    <script type="module" src="dist/components/dashboard.js"></script>
</body>
</html>
